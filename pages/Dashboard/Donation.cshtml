@model BloodBridge.Models.Donation
@{
    ViewData["Title"] = "Donation";
    var userName = User.Identity?.Name ?? "Guest"; // ‚úÖ Ensure username is retrieved
}

<!DOCTYPE html>
<html lang="en">
<head>
       <!-- üîç Metadata -->
    <meta name="description" content="BloodBridge connects blood donors and recipients efficiently across Ghana." />
    <meta name="author" content="Richard Boakye Yiadom" />
    <meta name="theme-color" content="#b30000" />

    <!-- üß† Favicon -->
    <link rel="icon" href="~/images/favicon.ico" type="image/x-icon" />

    <!-- üé® Stylesheets -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/layout.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/dashboard.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/Chartforum.css" asp-append-version="true" />

    <!-- ‚ö° External Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- üí° Custom Scripts -->
    <script src="~/js/site.js" asp-append-version="true"></script>
</head>

<body class="bg-light">
    <div class="container-fluid">
        <div class="row">
            

            <!-- üöÄ Donation Main Content -->
            <main class="col-md-9 col-lg-10 px-md-4 main-content">
                <div class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2 text-danger">Donate & Save Lives, @User.Identity?.Name </h1>
                </div>


                    

                <!-- ‚úÖ Success & Error Messages -->
                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="alert alert-success fade-in" role="alert">
                        @TempData["SuccessMessage"]
                    </div>
                }

                @if (TempData["ErrorMessage"] != null)
                {
                    <div class="alert alert-danger fade-in" role="alert">
                        @TempData["ErrorMessage"]
                    </div>
                }

               <!-- üåç Donation Impact Section -->
<div class="card mt-4 border-danger shadow">
    <div class="card-header bg-danger text-white text-center">
        <h4>How Your Donation Helps</h4>
    </div>
    <div class="card-body text-center">
        <p class="text-danger fs-5">üíñ <strong>Every donation can save up to 3 lives!</strong></p>
        <p class="text-muted">üè• Your contributions support hospitals and urgent cases.</p>

        <!-- Urgent Cases Call-to-Action -->
        <a asp-controller="Dashboard" asp-action="UrgentCases" class="btn btn-outline-danger mt-3">
            <i class="fas fa-exclamation-triangle"></i> See Urgent Cases
        </a>
    </div>
</div>

<!-- üåü Transparency & Commitment Section -->
<section class="section text-center my-5 bg-light p-4 rounded shadow-sm">
    <h2 class="text-danger fw-bold">Your Impact, Our Promise</h2>
    <p class="lead text-muted">
        Every contribution supports BloodBridge's mission‚Äîenhancing donor outreach, platform development,  
        and ensuring recipients receive life-saving donations.
    </p>
</section>

               <!-- ü©∏ Donation Form -->
<div class="container mt-4">
    <h2>Make a Difference Today</h2>

    <!-- ‚úÖ Error Message Container -->
    <div id="errorMessage" class="alert alert-danger text-center" style="display: none;"></div>

    <form method="post">
        <div class="mb-3">
            <label for="amount" class="form-label">Donation Amount (GHS)</label>
            <input type="number" class="form-control" id="amount" name="Amount" step="0.01" required>
        </div>

        <h4 class="mt-4">Choose Payment Method</h4>
        <div class="list-group">
            <button type="button" class="list-group-item list-group-item-action payment-option">üí≥ Card Payment</button>
            <button type="button" class="list-group-item list-group-item-action payment-option">üì± MTN MoMo</button>
            <button type="button" class="list-group-item list-group-item-action payment-option">üìû Vodafone Cash</button>
            <button type="button" class="list-group-item list-group-item-action payment-option">üõú Airtel Tigo Money</button>
        </div>

        <div class="form-check mt-3">
            <input type="checkbox" class="form-check-input" id="recurring" name="RecurringDonation">
            <label class="form-check-label" for="recurring">Make this a recurring monthly donation</label>
        </div>

        <div class="text-center mt-4">
            <button type="button" id="continueBtn" class="btn btn-danger btn-lg">Proceed to Payment</button>
        </div>
    </form>
</div>

<!-- Donation Step 2: Payment Processing -->
<div class="container mt-4 text-center" id="step2" style="display: none;">
    <h2 class="text-warning">Processing Payment...</h2>
    <p>Please complete your payment using the selected method.</p>
    <div class="spinner-border text-warning mt-3" role="status"></div>
    <div class="text-center mt-4">
        <button type="button" id="paymentSuccessBtn" class="btn btn-success btn-lg">Confirm Payment</button>
    </div>
</div>

<!-- Donation Step 3: Success Confirmation -->
<div class="container mt-5 text-center fade-in" id="step3" style="display: none;">
    <div class="card shadow-lg border-0">
        <div class="card-header bg-success text-white">
            <h2>‚úÖ Donation Successful!</h2>
        </div>
        <div class="card-body">
            <p>Thank you for your generosity. Your donation helps save lives!</p>
            <hr>
            <h4>Transaction Details</h4>
            <p><strong>Transaction ID:</strong> @Model.TransactionId</p>
            <p><strong>Amount:</strong> GHS @Model.Amount</p>
            <hr>
            <button class="btn btn-primary">Download Receipt</button>
            <p class="mt-3"><a href="/" class="text-muted">Return to Dashboard</a></p>
        </div>
    </div>
</div>


                </div>

                <!-- üí≥ Transaction History -->
                <div class="card mt-4 border-primary shadow">
                    <div class="card-header bg-primary text-white">
                        Your Past Donations
                    </div>
                    <div class="card-body">
                        <ul>
                            <li>GHS @Model.Amount donated on <strong>@Model.DonationDate??.ToString("MMM dd, yyyy")</strong></li>
                            <li><strong>Transaction ID:</strong> @Model.TransactionId</li>
                            <li>üè• <a asp-controller="Donations" asp-action="DonationHistory">View full donation history</a></li>
                        </ul>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            $(".payment-option").click(function () {
                $("#step1").hide();
                $("#step2").show();
            });

            $("#paymentSuccessBtn").click(function () {
                $("#step2").hide();
                $("#step3").show();
            });
        });

<!-- ‚úÖ Enhanced JavaScript for Validation & Navigation -->

    $(document).ready(function () {
        // ‚úÖ Handle payment option selection
        $(".payment-option").click(function () {
            $(".payment-option").removeClass("active");
            $(this).addClass("active");
        });

        // ‚úÖ Ensure amount and payment method are selected before proceeding
        $("#continueBtn").click(function () {
            let amount = $("#amount").val();
            let paymentMethodSelected = $(".payment-option.active").length > 0;

            // ‚úÖ Clear previous error messages
            $("#errorMessage").hide();

            if (!amount || amount <= 0) {
                showError("Please enter a valid donation amount.");
            } else if (!paymentMethodSelected) {
                showError("Please select a payment method before proceeding.");
            } else {
                $("#step1").hide();
                $("#step2").fadeIn();
            }
        });

        // ‚úÖ Function to show error messages dynamically
        function showError(message) {
            $("#errorMessage").text(message).fadeIn();
            setTimeout(() => {
                $("#errorMessage").fadeOut();
            }, 3000); // ‚úÖ Error disappears after 3 seconds
        }

        // ‚úÖ Confirm payment process & show success step
        $("#paymentSuccessBtn").click(function () {
            $("#step2").hide();
            $("#step3").fadeIn();
        });
    });





    </script>
</body>
</html>